# Лабораторна робота №2 з дисципліни «Архітектура для програмістів»

## Загальне завдання

Завдання лабораторної роботи наступне: реалізувати програму мовою С або С++, що виконує зчитування послідовності команд(програми) з файлу і заміняє віртуальні адреси на фізичні в командах, що визначаються варіантом. Тип організації пам'яті також визначається варіантом. Заміна адреси відбувається у випадку, якщо сторінка та/або сегмент знаходиться в оперативній пам'яті(ОП). Якщо потрібна віртуальна сторінка та/або сегмент відсутні в ОП, тоді має бути виведене повідомлення про помилку відсутності сторінки/сегменту, й аналіз команд має бути продовжено. Таблиця сторінок/сегментів задається у файлі формату CSV.

Програма має містити наступні компоненти:

1. Модуаль зчитування таблиці сторінок/сегментів з файлу CSV і створення внутрішнього представлення відповідної таблиці (або таблиць)
2. Модуль з реалізацією функцій зчитування, аналізу і зміни команд з текстового файлу, що виконує заміну віртуальних адрес в зчитаних командах на фізичні
3. Модуль тестування, що містить тестові утиліти і тести реалізованої програми.

## Варіант 23(8)

Тип організації пам'яті: сегментний.

РДТ: 2048(2^11)

Список команд: 1,2,4,5,21,23,25,26,29

## Сегментна організація пам'яті

Сегмент - адресний простір, що містить деяку структуру, процеду, масив або інший об'єкт. Сегментація пам'яті дає змогу зображати віртуальний адресний простір як сукупність незалежний блоків змінної довжини(сегментами). Програма може складатись з кількох сегментів.

Віртуальна адреса з врахуванням РДТ за варіантом виглядає так:

```plaintext
11              21
<=========><===================>
<Num of d ><Offset in segment  >

<Num of d> - Номер дескриптора сегменту
<Offset in segment> - Зміщення в сегменті
```

Сам дескриптор має вигляд:

```plaintext
11        8 * 4 = 32      4 * 5 = 20         1            11
<=========><===...======><====...===><       =      ><====...====>
<Num of d ><Base address><Size      ><Flag In Memory><Other Flags>

<Num of d> - Номер дескриптора сегменту
<Base address> - Базова адреса
<Size> - розмір
<Flag In Memory> - Прапорець присутності в пам'яті
```

Фізична адреса:

```plaintext
32
<=======...=======>
<Physical address>

<Physical address> := <Base address> + <Offset in segment>

<Physical address> - Фізична адреса
<Base address> - Базова адреса
<Offset in segment> - Зміщення в сегменті
```

Алгоритм перетворення віртуальної адреси у фізичну:

1. Беремо номер дескриптора сегменту з віртуальної адреси \<Num of d>
2. Отримуємо з таблиці дескрипторів відповідний дескриптор за \<Num of d>
3. Обраховуємо фізичну адресу \<Physical address>
   3.1. Беремо базову адресу \<Base address>
   3.2. Додаємо зміщення в сегменті \<Offset in segment>
4. Отримали фізичну адресу \<Physical address>

## Команди


| #  | Команда | Код команди (0x) |
| -- | -------------- | -------------------------- |
| 1  | MOV\<reg1>, \<reg2>        | 1A /reg1 /reg2             |
| 2  | MOV\<reg>, \<addr>        | 1B 0 /reg /addr            |
| 4  | ADD\<reg1>, \<reg2>        | 01 /reg1 /reg2             |
| 5  | ADD\<reg>, \<addr>        | 02 0 /reg /addr            |
| 21 | JMP\<addr>           | 91 /addr                   |
| 23 | JL\<addr>            | 93 /addr                   |
| 25 | JG\<addr>            | 95 /addr                   |
| 26 | CMP\<reg1>, \<reg2>        | 80 /reg1 /reg2             |
| 29 | MOV\<reg>, \<lit32>        | 1C 2 /reg /lit32           |

\<reg> - регістр загального призначення

\<addr> - віртуальна адреса

\<lit32> - константа 32-біт

/reg - номер регістру, 4 біти

/addr - адреса, 32 біти

/lit32 - беззнакове число розміром 32 біти

## Використання

outDebug.exe + CLI


| Коротко | Довго | Потребує путь до файлу | Обов'язковий | Опис                                         |
| -------------- | ---------- | ----------------------------------------- | ----------------------- | ------------------------------------------------ |
| -h             | --help     | НІ                                      | Ні                    | Виводить коротку справку   |
| -i             | --input    | Ні                                      | Так                  | Вхідний файл                          |
| -o             | --output   | Так                                    | Так                  | Вихідний файл                        |
| -t             | --table    | Так                                    | Так                  | Файл таблиці дескрипторів |
| -q             | --quiet    | Ні                                      | Ні                    | Тихий режим                            |
| -v             | --verify   | Так                                    | Ні                    | Звірка файлу                          |

## Будування

```
git clone git@github.com:73794449/arch-lab3.git 
cd arch-lab3 && make build
```


## Оцінювання
Робота і захист: 20/20